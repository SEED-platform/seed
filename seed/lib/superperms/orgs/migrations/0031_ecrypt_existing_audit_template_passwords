# Generated by Django 3.2.19 on 2023-05-11 18:49
from django.db import migrations, transaction
from seed.utils.encrypt import decrypt, encrypt

@transaction.atomic
def encrypt_existing_audit_template_passwords(apps, schema_editor):
    Organization = apps.get_model('orgs', 'Organization')

    for org in Organization.objects.iterator():
        _, error = decrypt(org.audit_template_password)
        if error:
            org.audit_template_password = encrypt(org.audit_template_password)
            org.save()


class Migration(migrations.Migration):
    dependencies = [
        ('orgs', '0030_accountability_hierarchy'),
    ]

    operations = [
        migrations.RunPython(encrypt_existing_audit_template_passwords),
    ]
