<div class="page_header_container">
    <div class="page_header">
        <div class="left page_action_container">
            <a ui-sref="organizations" class="page_action"><i class="fa fa-chevron-left"></i> {$:: 'Organizations' | translate $}</a>
        </div>
        <div class="page_title">
            <h1>{$:: org.name $}</h1>
        </div>
        <div class="right page_action_container"></div>
    </div>
</div>
<div class="section_nav_container">
    <div class="section_nav" ng-include="::urls.static_url + 'seed/partials/accounts_nav.html'"></div>
</div>
<div class="section">
    <div class="section_header_container">
        <div class="section_header has_no_padding fixed_height_short">
            <div class="section_action_container left">
                <h2><i class="fa fa-sitemap"></i> {$:: 'Access Level Tree' | translate $}</h2>
            </div>
        </div>
    </div>
    <div class="section_content_container">
        <div class="section_content with_padding">
            <div class="pad-top-10">
                <button type="button" class="btn btn-primary" ng-show="auth.requires_owner" ng-click="open_add_level_modal()">
                    {$:: 'Edit/Add Access Levels' | translate $}
                </button>

                <button type="button" class="btn btn-primary" ng-show="auth.requires_owner" ng-click="open_add_level_instance_modal()">
                    {$:: 'Add Access Level Instance' | translate $}
                </button>
                <button type="button" class="btn btn-primary" ng-show="auth.requires_owner" ng-click="open_upload_al_instances_modal()">
                    {$:: 'Upload Access Level Instances' | translate $}
                </button>

                <div id="access-level-tree">
                    <h2>{$:: access_level_tree[0].data.name $}
                        <button class="btn btn-info" type="button" ng-click="open_edit_al_instance_modal(access_level_tree[0].id, access_level_tree[0].data.name);
                        $event.preventDefault(); $event.stopPropagation();" tooltip-placement="right" uib-tooltip="Edit {$ access_level_tree[0].data.name $}">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                        </button>
                    </h2>
                    <div ng-if="access_level_names[1]">
                        <span>
                            <button class="btn btn-primary" type="button" ng-click="collapseAccordions(!accordionsCollapsed)"
                                style="padding: 1px 10px; margin: 5px 10px;">{$ accordionsCollapsed ? 'Expand All' : 'Collapse All' $}
                            </button>
                        </span>
                        <div class="level1">
                            {$ access_level_names[1] $}
                        </div>
                        <div class="accordion" id="cycle-container">
                            <div class="accordion-item" ng-repeat="l1 in access_level_tree[0].children track by l1.id" id="l1-{$ l1.id $}">
                                <div class="accordion-header">
                                    <button ng-if="l1.children.length" class="accordion-button levels-button" type="button" data-toggle="collapse" data-target="#target-{$ l1.id $}">
                                        <div style="display: flex;">
                                            <i class="fa fa-chevron-down accordion-indicator-default-open"></i>
                                            <div style="min-width: 300px; width: fit-content;">
                                                {$ l1.data.name $}
                                            </div>
                                            <div>
                                                <i class="fa fa-sitemap"></i>Items: {$ l1.children.length || 0 $}
                                            </div>

                                        </div>
                                    </button>
                                </div>
                                <div id="target-{$ l1.id $}" class="accordion-body collapse in level-collapse">

                                    <div class="section_content" style="width:95%; float:right; margin-right:10px;">
                                        <div style="padding:10px;">
                                        <button class="btn btn-info" type="button" ng-click="open_edit_al_instance_modal(l1.id, l1.data.name);
                                            $event.preventDefault(); $event.stopPropagation();"
                                            tooltip-placement="right" uib-tooltip="Edit {$ l1.data.name $}">
                                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"> </span> {$ l1.data.name $}
                                        </button>
                                        </div>
                                        <div ng-include="'tree'" ng-init="level=2;children=l1.children"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script type="text/ng-template" id="tree">
                        <!-- scope vars: level, children -->
                        <div class="table_list_container levels_table_item_detail">

                            <table ng-if="children.length > 0"
                                class="trigger-table table table-bordered table-striped table-condensed"
                                style="border-collapse:collapse;"
                                >
                                <thead>
                                    <tr>
                                    <th>{$ access_level_names[level] $}</th>
                                    <th width="80"><i class="fa fa-sitemap"></i> Items</th>
                                    <th width="50">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr
                                        ng-repeat-start="child in children track by child.id"
                                        class="accordion-toggle accordion-header"
                                        data-toggle="collapse"
                                        data-target="#target-{$ child.id $}"
                                    >
                                        <div>
                                            <td class="level-child">
                                                <i ng-if="child.children.length" class="fa fa-chevron-right"  id="indicator-{$ child.id $}">
                                                </i>
                                                {$ child.data.name $}
                                            </td>
                                            <td style="text-align:center;"><span class="badge badge-secondary">{$ child.children.length || 0 $}</span></td>
                                            <td>
                                                <button class="btn btn-info" type="button" ng-click="open_edit_al_instance_modal(child.id, child.data.name);
                                                $event.preventDefault(); $event.stopPropagation();" tooltip-placement="bottom" uib-tooltip="Edit {$ child.data.name $}">
                                                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                                </button>
                                                <button class="btn btn-info" type="button" ng-click="open_delete_al_instance_modal(child.id, child.data.name);
                                                $event.preventDefault(); $event.stopPropagation();" tooltip-placement="bottom" uib-tooltip="Delete {$ child.data.name $}">
                                                    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                                </button>
                                            </td>
                                        </div>
                                    </tr>
                                    <tr ng-repeat-end>
                                        <td colspan="6" class="hiddenRow" style="padding: 0px">
                                            <div class="accordian-body collapse level-collapse" id="target-{$ child.id $}">
                                                <div class="levels-header" ng-if="child.children.length">
                                                    <div style="width:95%;float:right;" ng-include="'tree'" ng-init="level=level+1;children=child.children"></div>
                                                </div>

                                            </div>
                                        </td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- <script>
function toggle_view(event) {
    event.stopPropagation();
    if (has_children) {
      element.toggleClass('collapsed');
    }
  }
</script> -->
