<script type="text/ng-template" id="typeahead.html">
  <a>
      <span ng-bind-html="match.label | uibTypeaheadHighlight:query"></span>
  </a>
</script>

<div class="page_header_container" ng-cloak>
    <div class="page_header">
        <div class="left page_action_container">
            <a ng-show="group_id != null" ui-sref="inventory_groups(::{inventory_type: inventory_type})"
                class="page_action">
                <i class="fa-solid fa-chevron-left"></i>
                {$:: 'Groups' | translate $}
            </a>
        </div>
        <div class="page_title">
            <h1>{$:: (group_id? 'Group - ': '')$}{$:: (inventory_type === 'taxlots' ? 'Tax Lots' : 'Properties') |
                translate $}</h1>
        </div>
        <div class="right page_action_container"></div>
    </div>
</div>

<div class="section_nav_container">
    <div ng-show="group_id == null" class="section_nav"
        ng-include="::urls.static_url + 'seed/partials/inventory_nav.html'"></div>
    <div ng-show="group_id != null" class="section_nav"
        ng-include="::urls.static_url + 'seed/partials/inventory_group_detail_nav.html'"></div>
</div>

<div class="section_header_container">
    <div class="section_header has_no_padding fixed_height_short">
        <div class="section_action_container left_40" >
            <h2><i class="fa-regular fa-building"></i><span>Create a {$ inventory_type === 'properties' ? 'Property' : 'Tax Lot'$}</span></h2>
        </div>
        <div class="section_action_container right_40 section_action_btn pull-right">
            <button class="btn btn-primary" ng-click="save_inventory()">Save {$ inventory_type == 'taxlots' ? 'TaxLot' : 'Property' $}</button>
        </div>
    </div>
</div>

<div class="section_content_container" style="padding: 20px;">
    <div class="section_content">
        <div class="content-row" >
            <div class="col-sm-4">
                <label for="select-level-name" translate>Access Level</label>
                <select id="select-level-name" class="form-control "
                ng-options="level.index as level.name for level in level_names" ng-change="change_selected_level_index()"
                ng-model="inventory.level_name_index" required></select>
            </div>
            <div class="col-sm-4">
                <label for="select-level-instance" translate>Level Instance</label>
                <select id="select-level-instance" class="form-control" ng-change=""
                ng-options="potential_level_instance.id as potential_level_instance.name for potential_level_instance in potential_level_instances"
                ng-model="inventory.access_level_instance" required></select>
            </div>
        </div>
        <div class="content-row">
            <div class="col-sm-4">
                <label for="cycle" translate>Cycle</label>
                <select id="select-cycle" class="form-control" ng-change=""
                    ng-options="cycle.id as cycle.name for cycle in cycles"
                    ng-model="inventory.cycle" required></select>
            </div>
        </div>
        <div class="content-row">
            <div class="col-sm-4">
                <label for="profile" translate>Column List Profile</label>
                <select id="select-profile" class="form-control" ng-change="change_profile()"
                    ng-options="profile as profile.name for profile in profiles"
                    ng-model="profile" ></select>
            </div>
            <div style="display:flex;">
                <button class="btn btn-default" style="margin: auto 0 0 20px;" ng-click="set_columns('canonical')">All Canonical Fields</button>
                <button class="btn btn-default" style="margin: auto 0 0 20px;" ng-click="set_columns('extra')">All Extra Data Fields</button>
                <button class="btn btn-default" style="margin: auto 0 0 20px;" ng-click="set_columns('reset')">Reset</button>
            </div>
        </div>
        <div style="margin-top: 40px; border-top: 1px solid #e0e0e0;">
            <table class="table table-striped">

                <thead>
                    <tr>
                        <th>Inventory Type</th>
                        <th>Column</th>
                        <th>Value</th>
                        <th>Matching Criteria</th>
                        <th>Extra Data</th>
                        <th>Data Type</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="column in inventory.form_columns track by $index">
                        <td>{$ column.table_name.slice(0, -5) $}</td>
                        <!-- <td style="max-width:200px;">{$ column.displayName $}</td> -->
                        <td ng-attr-id="row-input-{$:: $index $}">
                            <input type="text"
                                ng-model="column"
                                class="form-control"
                                ng-change="change_column(column, $index)"
                                typeahead-on-select="select_column(column, $index)"
                                placeholder="Column name"
                                typeahead-editable="true"
                                uib-typeahead="column as column.displayName for column in columns | filter:{displayName:$viewValue}"
                                typeahead-template-url="typeahead.html"
                                typeahead-editable="false"
                                typeahead-show-hint="true"
                                typeahead-min-length="0"
                                typeahead-select-on-exact="true"
                                typeahead-select-on-blur="true"
                                autocomplete="off"
                                autocorrect="off"
                                autocapitalize="off"
                                spellcheck="false"
                                aria-label="New column name" />
                        </td>
                        <td>
                            <input type="text" class="form-control" ng-model="column.value" ng-change="change_value(column.value, $index)" />
                        </td>
                        <td>{$ column.is_matching_criteria $}</td>
                        <td>{$ column.is_extra_data $}</td>
                        <td style="width: 100px;" >{$ column.data_type $}</td>
                        <td>
                            <button class="btn btn-danger" type="button" ng-click="remove_column($index)">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <button class="btn btn-default" ng-click="add_column()">Add Column</button>
        </div>
    </div>
</div>